この文章はデータベース・セミナー用の原稿です。
スライドは [Prezi] をみてください。

------------------------------------------------------------------

Oracle や MySQL などのデータベース製品は、
RDB とよばれるタイプのデータベース管理システムです。
RDB の「R」は「リレーショナル」という言葉に対応しています。
もちろん、「DB」は「データベース」に対応しています。
日本語になおすと、「リレーショナル」は「関係」という意味になります。
つまり、「RDB」は「関係データベース」、あるいは、
より形容詞らしくいうと、「関係型データベース」という日本語になります。
それでは 関係データベースとは、本質的には、なんでしょうか。
あるいは、関係データベースが立脚するところの理論である
関係モデルとは、本質的には、なんなのでしょうか。


関係モデル -- 判断することの計算体系
==================================================================

結論を先にいうと、関係モデルとは、「判断することの計算体系である」
という考え方を採用します。関係モデルをこのように捉えることで、
理論の形式と機能が、より明快に理解できるようになります。

(5 分)


SQL
------------------------------------------------------------------
(10 分 + 2 分)

データベース言語の SQL は、1970 年に理論が発表され、
そのおよそ 10 年後の 1979 年に Oracle の前身の
Relational Software Inc から最初の商用製品が発売されて以降、
データベースの標準として広く使われています。

SQL は関係モデルにもとづくデータベース言語のひとつです。
そのため、SQL データベースは関係データベース (RDB) として紹介されます。
しかし、そのもとづき方をよく見ていくと、
「おおよそ、もとづく」というものにすぎず、
厳密には、「準関係型」データベース言語とよぶべきものであることがわかります。
データベースの専門家のなかには、「疑似関係型」とよぶ人もいます。

Wikipedia の [関係モデル] のページをみてみると、
SQL が、どのような点で、関係モデルに準拠していないかが説明されています。
「関係」の代わりに「表」を使うという基本的違いを始め、
つぎのような違いがあります。

 - 行の重複
 - 名前のない列
 - 列名の重複
 - 列に順序がある
 - CHECK OPTION のないビュー
 - 表はひとつ以上の列をもつ
 - NULL

現在、関係モデルにまつわる技術的状況は、
SQL を通すと関係モデルはぼやけてしまうという状況にあり、
関係モデルの理論を知るには、特別の努力が必要であるといえます。
理論の本来のすがたを知らなければ、
理論を実践へ応用することも、実践を理論へ還元することも、十分に行えず、
結果として、関係モデルの潜在能力を発揮できないことにつながります。


E/R モデル
------------------------------------------------------------------

E/R モデルは、おもに、データ・モデリングの分野で使われる理論です。
「E」は「エンティティ」(entity) を意味し、
「R」はエンティティ間の「関連」(relationship) を意味します。
関係モデルと E/R モデルは、まったく、別の理論なので、
「関係」と「関連」というよく似た用語は、別の意味をもちます。

エンティティは、モデリングしようとする世界内の存在者です。
たとえば、「作品」「監督」「俳優」などはエンティティとみなせるし、
「監督する」「出演する」「公開する」などは関連とみなせるでしょう。

現在、E/R モデルは、データベース設計でよく使われており、
E/R モデルで表現した設計結果を、SQL データベースに変換して実装する
という方法が採用されることがあります。
この方法は十分な実績がありますが、同時に、問題点も残されたままです。
問題点とは、世界内の存在構造に注目する E/R モデルと、
言語を通して世界を分節化しようとする関係モデルとでは、
世界の見方が大きく異なるため、いわゆる、
インピーダンス・ミスマッチが大きいことです。

E/R モデルと関係モデルのどちらかを残して、
このミスマッチを解消するには、大きく分けて、
つぎの方針があります。

1. E/R モデルで設計して、E/R モデルと相性のよいデータベースに実装する。
2. 関係モデルに相性のよい方法で設計して、関係データベースに実装する。

このなかで、より簡単と思われる 2 の方法を考えましょう。

(10 分 + 2 分)


判断
------------------------------------------------------------------

エンティティのクラスと関係は、その性質にさまざまな違いがありますが、
判断の集合と関係は、自然に対応します。
ここでの判断とは、正しいか間違っているかが決まっている文のことです。
たとえば、「チャップリンは世界の三大喜劇王のひとりである」という文は判断です。
この文は、実際に、正しく、より正確にいえば、
世界を認識する主体であるわたしたちの心が正しいと判断します。

判断の一部を空欄にした「○○○○○ は世界の三大喜劇王のひとりである」
という文を考えると、「○○○○○」になにか具体的な名前を入れない限り、
判断としては未確定であるといえます。
この判断が正しくなるような「○○○○○」を集めてくると、

 - チャップリン
 - キートン
 - ロイド

の 3 人が当てはまります。この例はとても小さいですが、
三大喜劇王のデータベースにほかなりません。
「○○○○○」の部分を項目とよぶことにし、項目名 `/actor` を割り当てると、
「`/actor` は世界の三大喜劇王のひとりである」という項目化された文が得られます。
このような情報の表現方法をコンピュータが扱いやすくするために、
文のパターンに対して「三大喜劇王」のような名前を与え、
文の内容が正しいと判断する行為に `|--` という記号を当てると、
三大喜劇王についての 3 つの判断は、つぎのように書けます。

    |-- 三大喜劇王  /actor チャップリン
    |-- 三大喜劇王  /actor キートン
    |-- 三大喜劇王  /actor ロイド

ほかに、「○○○○○ という作品に ○○○○○ が出演している」
というパターンの文で、項目名を `/title` と `/cast` にすれば、
つぎのような判断として出演情報を表現できます。

    |-- 出演  /title ライムライト  /cast チャップリン
    |-- 出演  /title ライムライト  /cast ブルーム
    |-- 出演  /title ライムライト  /cast キートン
    |-- 出演  /title モダンタイムス  /cast チャップリン
    |-- 出演  /title うり二つ  /cast キートン

この先頭の記号 `|--` のたて棒 `|` は、「フレーゲ・ストローク」あるいは
「フレーゲの判断線」(Frege's judgement stroke) とよばれています。
わたしたちが、○○○○○ が正しいので、○○○○○ も正しいというような
論理的推論を行うときの、前提の判断や結論の判断をあらわすときに
使えるように考案された記号です。

データベースの検索も、正しい情報から、正しい情報をつくり出す
という枠組みでとらえられます。
たとえば、三大喜劇王のチャップリン、キートン、ロイドが
共演したことがあるかどうかを調べたいならば、
上の「三大喜劇王」と「出演」の判断を材料として、
「○○○○○ と ○○○○○ は作品 ○○○○○ で共演している」
という合成された判断をつくり出すことになるでしょう。

前提となる判断集合から、結論となる判断集合をつくるには、
情報を組み合わせる計算を行う必要があります。
この計算のための道具として関係モデルを使います。
前提となる判断集合を関係に変換し、
関係モデルの演算を使って関係から関係へと変換し、
最終的に得られた関係を結論となる判断集合にもどします。

    判断集合 (前提) → 関係 → 関係 → 関係 → 関係 → 判断集合 (結論)

この観点からは、関係モデルとは、判断集合から判断集合をみちびくときに使う
計算体系であるということになります。

(14 分 + 4 分)


計算例
------------------------------------------------------------------

三大喜劇王が共演に関する情報を「三大喜劇王」と「出演」という
判断の集合から計算してみましょう。

判断に関する計算を行うには、まず、判断の集合を関係に変換します。
つまり、判断集合

    |-- 三大喜劇王  /actor チャップリン
    |-- 三大喜劇王  /actor キートン
    |-- 三大喜劇王  /actor ロイド

    |-- 出演  /title ライムライト  /cast チャップリン
    |-- 出演  /title ライムライト  /cast ブルーム
    |-- 出演  /title ライムライト  /cast キートン
    |-- 出演  /title モダンタイムス  /cast チャップリン
    |-- 出演  /title うり二つ  /cast キートン

が、つぎのふたつの関係に変換されます。

    star
      /actor
      チャップリン
      キートン
      ロイド

    cast
      /title : /cast
      ライムライト : チャップリン
      ライムライト : ブルーム
      ライムライト : キートン
      モダンタイムス : チャップリン
      うり二つ : キートン

「出演」は `/title` と `/cast` という項目からなります。
一方、「三大喜劇王」は `/actor` という項目からなります。
このふたつの情報を組み合わせたいので、
`/actor` を `/cast` という名前に変更しましょう。

    star-2
      /cast
      チャップリン
      キートン
      ロイド

ふたつの関係 `star-2` と `cast` の交わりを計算すると、
喜劇王の出演情報が得られます。

    star-cast
      /title : /cast
      ライムライト : チャップリン
      ライムライト : キートン
      モダンタイムス : チャップリン
      うり二つ : キートン

誰と誰が共演したかを計算したいので、
`/cast` という項目名を `/cast-1` と
`/cast-2` に変更します。

    cast-1
      /title : /cast-1
      ライムライト : チャップリン
      ライムライト : キートン
      モダンタイムス : チャップリン
      うり二つ : キートン

    cast-2
      /title : /cast-2
      ライムライト : チャップリン
      ライムライト : キートン
      モダンタイムス : チャップリン
      うり二つ : キートン

このふたつの関係の交わりを計算し，
`/cast-1 = /cast-2` となる組を除外します．

    co-star-both
      /title : /cast-1 : /cast-2
      ライムライト : チャップリン : キートン
      ライムライト : キートン : チャップリン

`/cast-1` と `/cast-2` が反対になった組が冗長なので、
`/cast-1 < /cast-2` という条件を入れて、片方だけにしましょう。

    co-star
      /title : /cast-1 : /cast-2
      ライムライト : キートン : チャップリン

これを判断として書き出すと、「ライムライトでキートンとチャップリンが共演している」
という意味の情報が得られます。

    |-- 共演  /title ライムライト  /cast-1 キートン  /cast-2 チャップリン

いま、判断集合を関係に変換し、関係から関係への計算を行い、
結果の関係を判断集合にもどすという処理を行いました。
関係と判断集合は、ほとんど同じものといえますが、
関係は計算用途に特化した抽象的な記号であるのに対して、
判断はデータを解釈するための要素が含まれているという違いがあります。
これは、ちょうど、数が計算用途に特化した抽象的な記号であるのに対して、
その数を、本の冊数にも、山の高さにも、お金の量にも使えることに似ています。
いわば、数えることの計算体系として、数と四則演算があるように、
判断することの計算体系として、関係と関係演算があるといえるでしょう。

(14 分 + 4 分)


関係
------------------------------------------------------------------
(10 分 + 2 分)


まとめ
------------------------------------------------------------------

ここまで、関係モデルとは「判断することの計算体系である」という考え方が、
どのような内容であるかを紹介してきました。これは、データベースの利用
という文脈で、どのように役立つのでしょうか。

SQL データベースのテーブルの行をみたら、
それを判断というカテゴリの日本語の文章に対応させてみましょう。
つまり、正しいか間違っているかのどちらかになるような
日本語に翻訳するということです。できれば、そのときに、
フレーゲ・ストロークを頭に思い浮べてください。
フレーゲ・ストロークを思い浮べるとは、データベースには、
正しい情報が入っていると思うことです。
こうすることで、データの意味がはっきりとして、
ほかの人にも伝えやすくなります。
絵では伝わらない内容を、言葉で伝えましょう。

データベースを検索することは、正しい情報から、
合成された正しい情報をつくり出すことです。
これは、判断の集合から、合成された判断の集合をつくり出すということです。
データベースへのクエリは、判断集合が入力されて、
判断集合が出力される装置とみなせます。

より正確には、判断集合から意味を取り除いて、
計算に適した記号体である関係をつくっています。
クエリの内部では、関係から関係へと変換されていきますが、
そのステップごとの関係は、すべて判断集合へ戻せることに注意しましょう。

これらのことが、無意識にできるようになったら、
データベース設計にも、クエリの組み立てにも、
データベースの内容についての意思疎通にも役立ちます。

(8 分 + 2 分)


[Prezi]: http://prezi.com/s6wwdlz9vr1t/presentation/
[関係モデル]: http://ja.wikipedia.org/wiki/関係モデル#SQL.E6.A8.99.E6.BA.96
