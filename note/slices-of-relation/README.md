# 関係のうす切り


このノートでいうところの「関係のうす切り」とは、
関係を各組ごとに切り離し、それらを個別に入れ子の関係で
包み込むことを意味します。たとえば、つぎのような判断集合

```
|-- P  /a 10  /b 40
|-- P  /a 10  /b 50
```

に対して、演算子 `rel` を使って計算します。
この演算子は、関係の各組をバラして包み込んだ小さな関係に対して関係写像を適用し、
関係写像が出力した関係が、入れ子の関係として、もとの組に追加されます。
ここでは関係写像として、恒等写像の `id` を使うので、
入力の関係が、そのまま出力されます。

```
|== SLICE -fore /a /b :
    source P /a /b | rel /r id
```

そうすると、関係のうす切りが得られます。

```
|-- SLICE  /a 10  /b 40  /r {| /a : /b | 10 : 40 |}
|-- SLICE  /a 10  /b 50  /r {| /a : /b | 10 : 50 |}
```

このような関係のうす切りを応用すると、
演算子の `group` を簡単に実装できます。

まず、`group` の機能を確認しましょう。
この演算子は、入力関係で別の関係を分割した、
交わり部分関係を計算します。たとえば、

```
|== GROUP -fore /a /b :
    p | group /g q
```

によって、計算した結果は、共有項目 `/b`
の内容で分割した、つぎのような結果になります。

```
|-- GROUP  /a 10  /b 40  /g {| /b : /c | 40 : 80 | 40 : 70 |}
|-- GROUP  /a 10  /b 50  /g {| /b : /c | 50 : 90 |}
```

関係写像演算子 `rel` `meet` `pick-term` を使うと、
`group` と同等の計算ができます。

```
|== REL -fore /a /b : 
    p | rel /r ( meet q | pick-term q )
```

この計算結果は、`|-- GROUP` の場合とちょうど同じになります。

```
|-- REL  /a 10  /b 40  /r {| /b : /c | 40 : 80 | 40 : 70 |}
|-- REL  /a 10  /b 50  /r {| /b : /c | 50 : 90 |}
```

