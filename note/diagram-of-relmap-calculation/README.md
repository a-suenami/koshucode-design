# 関係写像による計算の図解



このノートでは、関係写像を実行するときのデータ型を図解します。
甲州計算機のバージョン 0.50 に対応します。

甲州計算機は、全体として、入力文字列から出力文字列を
計算するという枠組みで動作します。
入力文字列のうち、あるものは計算式であり、
あるものはその計算式に対するデータです。
具体的には、計算式は関係写像のことで、データとは判断集合です。
そのため、関係写像をあらわす文字列 `String` から
実行可能な関係写像 `Relkit` を組み立て、
判断集合をあらわす文字列 `String` から
判断集合 `J :: [Judge c]` を組み立てます。


計算の図解
------------------------------------------------------------------

つぎの図は、関係写像を使って判断集合から判断集合を
計算するときに関わる主要なデータ型を図解しています。
左端の `String` が入力の判断集合の文字列表現、
右端の `String` が出力の判断集合の文字列表現、
下端の `String` が関係写像の文字列表現に対応します。

```
String ----- J ----- R ----- B ----- Relkit ----- B ----- R ----- J ----- String
             |                         :                /         |
             P T             H ----- Relmap ----- H ---           P
                                       :
                                     Lexmap          Relkit : Specialized relmap
J :: [Judge c]  R :: Rel c             :             Relmap : Generic relmap    
P :: String     H :: Relhead         String          Lexmap : Lexical relmap    
T :: [String]   B :: [[c]]                           String : Text relmap       
```


関係写像の組み立て
------------------------------------------------------------------

関係写像の組み立ては、つぎのように実行されます。

 1. 関係写像の入力文字列 `String` から文面写像 `Lexmap` を組み立てます。

 2. 文面写像 `Lexmap` から総称関係写像 `Relmap` を組み立てます。

 3. 総称関係写像 `Relmap` と入力の見出し `H :: Relhead` を組み合わせて、
    特定関係写像 `Relkit` を組み立てます。
    このときに使う見出しは、判断集合には依存せず、関係写像のみから決まります。

 4. さらに、複数の 特定関係写像 `Relkit` をリンクして、
    実行可能な `Relkit` を組み立てる過程がありますが、図では省略しています。


判断集合の変換
------------------------------------------------------------------

関係写像を使って判断集合が変換されます。
この計算は、つぎのように実行されます。

 1. 判断集合の入力文字列 `String` から判断集合 `J :: [Judge c]` を組み立てます。

 2. 判断種 `P :: String` と `T :: [String]` を指定して、
    判断集合 `J :: [Judge c]` を関係 `R :: Rel c` に変換します。

 3. 関係 `R : Rel c` からその本体 `B :: [[c]]` を取り出します。

 4. 関係の本体 `B :: [[c]]` を特定関係写像 `Relkit` に入力し、
    出力関係の本体 `B :: [[c]]` を計算します。

 5. 出力関係の本体 `B :: [[c]]` と関係写像の最後の見出し `H :: Relhead` を組み合わせ、
    出力関係 `R :: Rel c` を作ります。

 6. 出力関係 `R :: Rel c` と判断種 `P :: String` を組み合わせ、
    出力される判断集合 `J :: [Judge c]` に変換します。

 7. 出力される判断集合 `J :: [Judge c]` を文字列 `String` に変換します。

