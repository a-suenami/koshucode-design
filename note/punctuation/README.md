# 甲州記法の句読法

甲州記法のコードは、まず、CRLF または LF または CR で区切ることで、
行単位に分割され、各行内で語彙単位に分割されます。
このノートは、語彙単位に分割するときの句読法を説明します。


括弧
------------------------------------------------------------------

括弧類は、`(` `)`、`[` `]`、`{` `}` と、
括弧のすぐ内側の文字 `-` `=` `|` `?` の組み合わせからなります。
`[?` のような存在しない組み合わせも予約されています。

| _開始記号_ | _終了記号_ | _用途_ |
|------|------|-----|
| `(`  | `)`  | グループ |
| `[`  | `]`  | リスト |
| `{`  | `}`  | 集合 |
| `[-` | `-]` | 型 |
| `[=` | `=]` | Base64 |
| `{-` | `-}` | 束 |
| `{=` | `=}` | 関係 |
| `{|` | `|}` | 解釈 |
| `{?` | `?}` | 計算外 |


開始と終了に挟まれる記号
------------------------------------------------------------------

二重引用符 `"` で挟まれる文字列など、
開始文字と終了文字で境界が定まる記号があります。
二重引用符自身は `<qq>` というキーワードであらわされます。
閉じていない二重引用符はエラーになります。

`<` と `>` に挟まれた文字列で、
中間が平記号になっている場合は、キーワードに分類されます。
`<=>` のように平記号ではないときは、一般記号に分類されます。

| _開始記号_ | _後続文字_ | _終了記号_ | _用途_ |
|-----|-----|-----|-----|
| `"` | 二重引用符以外 | `"` | 文字列 |
| `<` | 平記号 | `>` | キーワード |
| `|` | 経過時間記号 | `|` | 経過時間 |
| `[=` | Base64 | `=]` | Base64 |
| `{|` | 解釈 | `|}` | 解釈 |
| `**` | 任意 | 行末 | 注釈 |
| 行頭 `#!` | 任意 | 行末 | 注釈 (UNIX コマンド指定) |
| 行頭 `-*-` | 任意 | 行末 | 注釈 (Emacs モード指定) |
| 行頭 `===` | 任意 | 行末 | 区 |


開始記号と後続文字からなる記号
------------------------------------------------------------------

開始記号が以下の表の文字であるとき、後続する平記号を読み、
開始記号に応じた用途に使います。

| _開始記号_ | _後続文字_ | _用途_ |
|-----|-----|-----|
| `'` | 平記号 | 符号 |
| `/` | 平記号 | 項目 |
| `+/` | 平記号 | 肯定項目 |
| `-/` | 平記号 | 否定項目 |
| `'/` | 平記号 | 項目名 |
| `^` | 平記号 | 局所関係参照 |
| `^/` | 平記号 | 関係項目参照 |
| `@'` | 平記号 | 局所位置スロット |
| `@` | 平記号 | 局所名称スロット |
| `@@` | 平記号 | 大域スロット |
| `-` | 平記号 | 局所オプション |
| `--` | 平記号 | 大域オプション |


省略記号
------------------------------------------------------------------

**省略記号** (short sign) は `h.world` のような
ピリオド `.` を平記号で挟んだ記号です。
`h` は、省略設定により、ほかの記号に展開されます。

 - `h` が文字列 `"hello-"` の省略形なら、
   `h.world` が文字列 `"hello-world"` へ展開されます。
 - `h` が符号 `'hello-` の省略形なら、
   `h.world` が符号 `'hello-world` へ展開されます。
 - `h` が符号 `hello-` の省略形なら、
   `h.world` が一般記号の `hello-world` へ展開されます。

| _文字列_ | _用途_ |
|-----|-----|
| 非数平記号 `.` 平記号 | 省略記号 |

非数平記号は、平記号のうち、数記号ではないものを意味します。
平記号、一般記号、数記号のうち、
複数に該当している記号を **重複記号** (overlapped sign) とよびます。
重複記号を読み込んでいる途中で `.` が出現すると、
`.` の左側に応じて、つぎのように分かれます。

 - 数記号のとき、小数を読む文脈になります。
 - そうではなく、平記号のとき、省略記号を読む文脈になります。
 - そうではなく、一般記号のとき、エラーになります。


平記号
------------------------------------------------------------------

**平記号** (ordinary sign) は、`hello-world` のような
「ふつうの文字」の並びを意味します。
具体的には、つぎのいずれかに該当する文字です。

| _文字_ | _備考_ |
|-----|-----|
| Letter | `a` から `z` など |
| Mark | `हिन्दी` (ヒンディ) における `ि` |
| Number | `0` から `9` |
| `-` | ハイフン |
| `_` | アンダースコア |

Letter、Mark、Number は Unicode の一般カテゴリです。

平記号は、出現文脈が決まっており、
その文脈以外で、一般記号としても解釈できる平記号は、一般記号になります。
`/ab*` のように、出現文脈に平記号ではない一般記号が書かれるとエラーになります。

甲州記法では、平記号として、アルファベット、
数字、ハイフンの組み合わせを使うことを推奨しています。
アンダースコアはできるだけ使わないようにします。


一般記号
------------------------------------------------------------------

**一般記号** (general sign) は、以下の表の文字の 1 文字以上の並びで、
関係写像の演算子名 `meet` や、
不等号 `<` `<=` などを書くためにに使われます。
`<<<` のような未定義の記号も一般記号に分類されます。

| _文字_ | _用途_ |
|-----|-----|
| Letter | |
| Mark | |
| Number | |
| `_` | 通常は使いません |
| `-` | 単語の区切りや減算など |
| `+` | 加算など |
| `*` | 乗算など |
| `=` | 等号など |
| `<` | 不等号など |
| `>` | 不等号など |


数記号
------------------------------------------------------------------

**数記号** (numeric sign) は、小数 `12.34` や時刻 `2016-04-01 12:00` や
経過時間 `|3:30|` をあらわすための記号です。
数・時刻と経過時間に分けてあります。

数記号と一般記号は、たとえば、`12` が両方に属すという意味で重なりがあります。
`1a` は `a` を含んでおり数記号ではないため、一般記号に分類されます。
小数点 `.` とハッシュ記号 `#` は一般記号に含まれていないため、
`12.34` などは数記号に確定します。

### 数・時刻

| _文字_ | _用途_ |
|-----|-----|
| `0` .. `9` | 数字 |
| `+` | 正負の正 |
| `-` | 正負の負、年月日の区切り |
| `.` | 小数点 |
| `#` | 週番号 |
| 空白 | 年月日と時分秒の区切りなど |

### 経過時間

経過時間は `|` と `|` で囲まれた、つぎの表の文字の並びです。
途中に空白は含められません。
マイナスの経過時間は `- |0:30|` のように書きます。

| _文字_ | _用途_ |
|-----|-----|
| `0` .. `9` | 数字 |
| `.` | 小数点 |
| `:` | 時分秒の区切り |
| `'` | 日数と時間の区切り |

`|` から始まる記号は、(1) 経過時間か (2) 判断記号か
(3) 特殊記号の単独の `|` になります。
これらを分類するには、つぎの規則を使います。

 - `|` のつぎの文字が `-` か `=` であれば判断記号
 - `|` のつぎの文字が `0` から `9` であれば経過時間
 - それ以外であれあば特殊記号

### キーワード

数記号といっしょに使われるキーワードがあります。
たとえば、`<ce> 2016` は 2016 年をあらわします。

| _キーワード_ | _用途_ |
|-----|-----|
| `<ce>` | 紀元後 (common era) |
| `<bce>` | 紀元前 (before common era) |
| `<a>` | 近似 (approximated) |


判断記号
------------------------------------------------------------------

**判断記号** (judgement sign) は、判断、または、判断の計算の行頭に書かれる記号で、
以下の表の組み合わせがあります。
`|` の後に `-` または `=` がひとつ以上続き、
その後に `a` .. `z` まはた `A` .. `Z` がひとつ以上続く記号は、
`|--aa` のような存在しないものを含めて予約されています。

| _判断_  | _計算_ | _用途_ |
|--------|--------|--------|
| `|--`  | `|==`  | 肯定判断 |
| `|-x`  | `|=x`  | 単数否定判断 |
| `|-xx` | `|=xx` | 複数否定判断 |
| `|-c`  | `|=c`  | 単数変更判断 |
| `|-cc` | `|=cc` | 複数変更判断 |
| `|-v`  | `|=v`  | 異常判断 |


特殊記号
------------------------------------------------------------------

**特殊記号** (special sign) は、以下の表の文字列です。

| _文字列_ | _用途_ |
|-------|-----|
| `()` | 空 |
| `(+)` | 真 |
| `(-)` | 偽 |
| `(#)` | 万 |
| `|` | 連結 |
| `:` | 定義 |


Base64
------------------------------------------------------------------

**Base64** を読む文脈では、つぎの文字のみが許されます。
`[=` から `=]` までの間が Base64 の文脈です。

| _文字_ | _用途_ |
|-------|-------|
| `A` .. `Z` | 0 .. 25 |
| `a` .. `z` | 26 .. 51 |
| `0` .. `9` | 52 .. 61 |
| `+` | 62 |
| `/` | 63 |
| `=` | パディング |
| 空白 | 空白 |

